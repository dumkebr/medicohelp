name: Deploy AutomÃ¡tico - Hostinger VPS

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v3
      
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: ğŸ“š Install dependencies
        run: npm ci
      
      - name: ğŸ”¨ Build frontend
        run: npm run build
        env:
          NODE_ENV: production
      
      - name: ğŸ“ Verificar arquivos compilados
        run: |
          echo "=== Arquivos crÃ­ticos compilados ==="
          ls -lh dist/public/assets/index-*.js 2>/dev/null || echo "JS nÃ£o encontrado!"
          ls -lh dist/public/assets/index-*.css 2>/dev/null || echo "CSS nÃ£o encontrado!"
          echo ""
          echo "=== Tamanho total dos assets ==="
          du -sh dist/public/assets/
      
      - name: ğŸš€ Deploy via SCP (TODOS os arquivos)
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.SFTP_HOST }}
          username: ${{ secrets.SFTP_USER }}
          password: ${{ secrets.SFTP_PASS }}
          port: ${{ secrets.SFTP_PORT }}
          source: "dist/public/*"
          target: "/var/www/medicohelp/dist/"
          strip_components: 1
          rm: false
          overwrite: true
          timeout: 10m
          command_timeout: 10m
      
      - name: ğŸ‰ Deploy finalizado
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… DEPLOY AUTOMÃTICO CONCLUÃDO!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸŒ Site: www.medicohelp.com.br"
          echo "ğŸ“… Deploy: $(date)"
          echo ""
          echo "âš ï¸  Limpe o cache do navegador (Ctrl+Shift+R)"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
